{"version":3,"sources":["../src/utils.js"],"names":["KeyCodes","SHIFT","TAB","ARROW_UP","ARROW_DOWN","Selectors","NOT_VISUALLY_HIDDEN","FOCUSABLE_TAGS","KEYBOARD_CLASS","Events","KEYDOWN","CLICK","Utils","_listenForKeyboard","bind","_listenForClick","_handleFocusTrapWithTab","_handleFocusTrapWithArrows","_focusContainerSelector","_focusableChildren","_focusableFirstChild","_focusableLastChild","_listeningForKeydown","_trapFocusWithArrows","container","options","getFocusableElements","length","useArrows","document","addEventListener","removeEventListener","element","nodeList","querySelectorAll","Array","apply","focusables","map","getElements","join","event","tabKey","which","shiftKey","arrowUp","arrowDown","body","classList","add","remove","containerElement","querySelector","containerActive","activeElement","firstActive","lastActive","hasShift","noShift","preventDefault","focus","_focusNextChild","_focusLastChild","i"],"mappings":"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","sourcesContent":["\"use strict\"\n\nconst KeyCodes = {\n  SHIFT: 16,\n  TAB: 9,\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n}\n\nconst Selectors = {\n  NOT_VISUALLY_HIDDEN: \":not(.is-visually-hidden)\",\n  FOCUSABLE_TAGS: [\"a\", \"button\", \"input\", \"object\", \"select\", \"textarea\", \"[tabindex]\"],\n  KEYBOARD_CLASS: \"using-keyboard\",\n}\n\nconst Events = {\n  KEYDOWN: \"keydown\",\n  CLICK: \"click\",\n}\n\n/**\n * Utility methods for DOM traversal and focus trapping.\n * @module Utils\n */\nexport default class Utils {\n  constructor() {\n    // events\n    this._listenForKeyboard = this._listenForKeyboard.bind(this)\n    this._listenForClick = this._listenForClick.bind(this)\n    this._handleFocusTrapWithTab = this._handleFocusTrapWithTab.bind(this)\n    this._handleFocusTrapWithArrows = this._handleFocusTrapWithArrows.bind(this)\n\n    this._focusContainerSelector = \"\"\n    this._focusableChildren = []\n    this._focusableFirstChild = {}\n    this._focusableLastChild = {}\n    this._listeningForKeydown = false\n    this._trapFocusWithArrows = false\n  }\n\n  // public\n\n  /**\n   * Listens to the first and last elements matched from this.getFocusableElements()\n   * @param {String} container - The container's class, attribute, etc.\n   * @param {Object} options - Optional has hof options.\n   */\n  captureFocus(container, options) {\n    this._focusContainerSelector = container\n    this._focusableChildren = this.getFocusableElements(this._focusContainerSelector)\n    this._focusableFirstChild = this._focusableChildren[0]\n    this._focusableLastChild = this._focusableChildren[this._focusableChildren.length - 1]\n\n    if (options) {\n      if (options.useArrows) {\n        this._trapFocusWithArrows = options.useArrows || this._trapFocusWithArrows\n        document.addEventListener(Events.KEYDOWN, this._handleFocusTrapWithArrows)\n      }\n    } else {\n      document.addEventListener(Events.KEYDOWN, this._handleFocusTrapWithTab)\n    }\n  }\n\n  /**\n   * Stop trapping focus set in this.captureFocus()\n   */\n  releaseFocus() {\n    if (this._trapFocusWithArrows) {\n      document.removeEventListener(Events.KEYDOWN, this._handleFocusTrapWithArrows)\n      this._trapFocusWithArrows = false\n    } else {\n      document.removeEventListener(Events.KEYDOWN, this._handleFocusTrapWithTab)\n    }\n  }\n\n  /**\n   * Begin listening to _listenForKeyboard()\n   */\n  enableFocusOutline() {\n    document.addEventListener(Events.KEYDOWN, this._listenForKeyboard)\n  }\n\n  /**\n   * Completely disable focus outline utility.\n   */\n  disableFocusOutline() {\n    if (this._listeningForKeydown) {\n      document.removeEventListener(Events.KEYDOWN, this._listenForKeyboard)\n    } else {\n      document.removeEventListener(Events.CLICK, this._listenForClick)\n    }\n  }\n\n  /**\n   * Because IE does not recognize NodeList.forEach(),\n   * we use a cross-browser solution for returning an array of DOM nodes every time.\n   * @param {String} element - A DOM node's class, attribute, etc., to search the document.\n   * @return {Array}\n   */\n  getElements(element) {\n    const nodeList = document.querySelectorAll(element)\n    return Array.apply(null, nodeList)\n  }\n\n  /**\n   * Creates a string of element selector patterns using common elements.\n   * @param {String} container - The enclosing container's class, attribute, etc.\n   * @return {String}\n   */\n  getFocusableElements(container) {\n    const focusables = Selectors.FOCUSABLE_TAGS.map(element => {\n      return `${container} ${element}${Selectors.NOT_VISUALLY_HIDDEN}`\n    })\n\n    return this.getElements(focusables.join(\", \"))\n  }\n\n  // private\n\n  /**\n   * When a key is pressed, detect if it's tab or shift keys and enable\n   * focus outlines on currently focused element(s). Then, remove keydown listener\n   * and add click listener on _listenForClick().\n   * @param {Object} event - Event (keypress).\n   */\n  _listenForKeyboard(event) {\n    const tabKey = event.which === KeyCodes.TAB\n    const shiftKey = event.which === KeyCodes.SHIFT || event.shiftKey\n    const arrowUp = event.which === KeyCodes.ARROW_UP\n    const arrowDown = event.which === KeyCodes.ARROW_DOWN\n\n    if (tabKey || shiftKey || arrowUp || arrowDown) {\n      document.body.classList.add(Selectors.KEYBOARD_CLASS)\n      document.removeEventListener(Events.KEYDOWN, this._listenForKeyboard)\n      document.addEventListener(Events.CLICK, this._listenForClick)\n      this._listeningForKeydown = false\n    }\n  }\n\n  /**\n   * On click, remove Selectors.KEYBOARD_CLASS and re-add keydown listener.\n   * @param {Object} event - Event (keypress).\n   */\n  _listenForClick(event) {\n    document.body.classList.remove(Selectors.KEYBOARD_CLASS)\n    document.removeEventListener(Events.CLICK, this._listenForClick)\n    document.addEventListener(Events.KEYDOWN, this._listenForKeyboard)\n    this._listeningForKeydown = true\n  }\n\n  /**\n   * Handles focus on first or last child in a container, using tab and tab+shift keys.\n   * @param {Object} event - Event (keypress)\n   */\n  _handleFocusTrapWithTab(event) {\n    const containerElement = document.querySelector(this._focusContainerSelector)\n    const containerActive = document.activeElement === containerElement\n    const firstActive = document.activeElement === this._focusableFirstChild\n    const lastActive = document.activeElement === this._focusableLastChild\n    const tabKey = event.which === KeyCodes.TAB\n    const shiftKey = event.which === KeyCodes.SHIFT || event.shiftKey\n    const hasShift = shiftKey && tabKey\n    const noShift = !shiftKey && tabKey\n\n    if (shiftKey && tabKey && (firstActive || containerActive)) {\n      event.preventDefault()\n      this._focusableLastChild.focus()\n    } else if (!shiftKey && tabKey && lastActive) {\n      event.preventDefault()\n      this._focusableFirstChild.focus()\n    }\n  }\n\n  /**\n   * Handles focus on the first, last, next, or previous child in a container, using up and down arrow keys.\n   * @param {Object} event - Event (keypress)\n   */\n  _handleFocusTrapWithArrows(event) {\n    const firstActive = document.activeElement === this._focusableFirstChild\n    const lastActive = document.activeElement === this._focusableLastChild\n    const arrowUp = event.which === KeyCodes.ARROW_UP\n    const arrowDown = event.which === KeyCodes.ARROW_DOWN\n\n    if (arrowUp || arrowDown) {\n      event.preventDefault()\n\n      if (firstActive && arrowUp) {\n        this._focusableLastChild.focus()\n      } else if (lastActive && arrowDown) {\n        this._focusableFirstChild.focus()\n      } else if (arrowDown) {\n        this._focusNextChild()\n      } else if (arrowUp) {\n        this._focusLastChild()\n      }\n    }\n  }\n\n  /**\n   * Focus the next child in this._focusableChildren.\n   */\n  _focusNextChild() {\n    for (let i = 0; i < this._focusableChildren.length; i++) {\n      if (this._focusableChildren[i] === document.activeElement) {\n        this._focusableChildren[i + 1].focus()\n        break\n      }\n    }\n  }\n\n  /**\n   * Focus the previous child in this._focusableChildren.\n   */\n  _focusLastChild() {\n    for (let i = 0; i < this._focusableChildren.length; i++) {\n      if (this._focusableChildren[i] === document.activeElement) {\n        this._focusableChildren[i - 1].focus()\n        break\n      }\n    }\n  }\n}\n"],"file":"utils.js"}