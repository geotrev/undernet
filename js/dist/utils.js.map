{"version":3,"sources":["../src/utils.js"],"names":["KeyCodes","SHIFT","TAB","ARROW_UP","ARROW_DOWN","Selectors","FOCUSABLE_TAGS","KEYBOARD_CLASS","NOT_VISUALLY_HIDDEN_CLASS","Events","KEYDOWN","CLICK","dom","attr","element","newValue","removeAttribute","setAttribute","getAttribute","hasAttr","hasAttribute","find","selector","parent","document","querySelector","findAll","querySelectorAll","css","property","value","style","addClass","classes","classList","add","removeClass","remove","hasClass","length","filter","cls","contains","getFocusableElements","container","focusables","map","join","iOSMobile","test","navigator","userAgent","Utils","_listenForKeyboard","bind","_listenForClick","_handleFocusTrapWithTab","_handleFocusTrapWithArrows","_focusContainerSelector","_focusableChildren","_focusableFirstChild","_focusableLastChild","_listeningForKeydown","_trapFocusWithArrows","options","useArrows","addEventListener","removeEventListener","body","event","containerElement","containerActive","activeElement","firstActive","lastActive","tabKey","which","shiftKey","hasShift","noShift","preventDefault","focus","arrowUp","arrowDown","_focusNextChild","_focusLastChild","i"],"mappings":"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","sourcesContent":["const KeyCodes = {\n  SHIFT: 16,\n  TAB: 9,\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n}\n\nconst Selectors = {\n  FOCUSABLE_TAGS: [\"a\", \"button\", \"input\", \"object\", \"select\", \"textarea\", \"[tabindex]\"],\n  KEYBOARD_CLASS: \"using-keyboard\",\n  NOT_VISUALLY_HIDDEN_CLASS: \":not(.is-visually-hidden)\",\n}\n\nconst Events = {\n  KEYDOWN: \"keydown\",\n  CLICK: \"click\",\n}\n\n/**\n * Simple DOM manipulator methods. NOTE: These aren't chainable.\n */\nexport const dom = {\n  attr: (element, attr, newValue) => {\n    if (newValue === false) {\n      return element.removeAttribute(attr)\n    }\n\n    if (typeof newValue === \"string\" || newValue === null) {\n      return element.setAttribute(attr, newValue)\n    }\n\n    return element.getAttribute(attr)\n  },\n  hasAttr: (element, attr) => element.hasAttribute(attr),\n\n  find: (selector, parent = document) => parent.querySelector(selector),\n  findAll: (selector, parent = document) => [...parent.querySelectorAll(selector)],\n\n  css: (element, property, value) => {\n    if (typeof value === \"string\" || value === null) {\n      return (element.style[property] = value)\n    }\n\n    return element.style[property]\n  },\n\n  addClass: (element, ...classes) => element.classList.add(...classes),\n  removeClass: (element, ...classes) => element.classList.remove(...classes),\n  hasClass: (element, ...classes) => {\n    if (classes.length) {\n      return classes.filter(cls => element.classList.contains(cls)).length\n    }\n\n    return element.classList.contains(classes[0])\n  },\n}\n\n/**\n * Return an array literal of elements matching focusable elements within a given container.\n */\nexport const getFocusableElements = container => {\n  const focusables = Selectors.FOCUSABLE_TAGS.map(\n    element => `${container} ${element}${Selectors.NOT_VISUALLY_HIDDEN_CLASS}`\n  ).join(\", \")\n\n  return dom.findAll(focusables)\n}\n\n/**\n * Check if the current browser session is within an Apple device.\n */\nexport const iOSMobile = /(iphone|ipod|ipad)/i.test(navigator.userAgent)\n\n/**\n * Utility class to help with focus trapping and keyboard outline management.\n * Components extend from this method.\n */\nexport default class Utils {\n  constructor() {\n    // events\n    this._listenForKeyboard = this._listenForKeyboard.bind(this)\n    this._listenForClick = this._listenForClick.bind(this)\n    this._handleFocusTrapWithTab = this._handleFocusTrapWithTab.bind(this)\n    this._handleFocusTrapWithArrows = this._handleFocusTrapWithArrows.bind(this)\n\n    // instance data\n    this._focusContainerSelector = \"\"\n    this._focusableChildren = []\n    this._focusableFirstChild = {}\n    this._focusableLastChild = {}\n    this._listeningForKeydown = false\n    this._trapFocusWithArrows = false\n  }\n\n  // public\n\n  captureFocus(container, options) {\n    this._focusContainerSelector = container\n    this._focusableChildren = getFocusableElements(this._focusContainerSelector)\n    this._focusableFirstChild = this._focusableChildren[0]\n    this._focusableLastChild = this._focusableChildren[this._focusableChildren.length - 1]\n\n    if (options) {\n      if (options.useArrows) {\n        this._trapFocusWithArrows = options.useArrows || this._trapFocusWithArrows\n        document.addEventListener(Events.KEYDOWN, this._handleFocusTrapWithArrows)\n      }\n    } else {\n      document.addEventListener(Events.KEYDOWN, this._handleFocusTrapWithTab)\n    }\n  }\n\n  releaseFocus() {\n    if (this._trapFocusWithArrows) {\n      document.removeEventListener(Events.KEYDOWN, this._handleFocusTrapWithArrows)\n      this._trapFocusWithArrows = false\n    } else {\n      document.removeEventListener(Events.KEYDOWN, this._handleFocusTrapWithTab)\n    }\n  }\n\n  enableFocusOutline() {\n    document.addEventListener(Events.KEYDOWN, this._listenForKeyboard)\n  }\n\n  disableFocusOutline() {\n    if (this._listeningForKeydown) {\n      document.removeEventListener(Events.KEYDOWN, this._listenForKeyboard)\n    } else {\n      document.removeEventListener(Events.CLICK, this._listenForClick)\n    }\n  }\n\n  // private\n\n  _listenForKeyboard() {\n    document.body.classList.add(Selectors.KEYBOARD_CLASS)\n    document.removeEventListener(Events.KEYDOWN, this._listenForKeyboard)\n    document.addEventListener(Events.CLICK, this._listenForClick)\n    this._listeningForKeydown = false\n  }\n\n  _listenForClick() {\n    document.body.classList.remove(Selectors.KEYBOARD_CLASS)\n    document.removeEventListener(Events.CLICK, this._listenForClick)\n    document.addEventListener(Events.KEYDOWN, this._listenForKeyboard)\n    this._listeningForKeydown = true\n  }\n\n  _handleFocusTrapWithTab(event) {\n    const containerElement = dom.find(this._focusContainerSelector)\n    const containerActive = document.activeElement === containerElement\n    const firstActive = document.activeElement === this._focusableFirstChild\n    const lastActive = document.activeElement === this._focusableLastChild\n    const tabKey = event.which === KeyCodes.TAB\n    const shiftKey = event.which === KeyCodes.SHIFT || event.shiftKey\n    const hasShift = shiftKey && tabKey\n    const noShift = !shiftKey && tabKey\n\n    if (hasShift && (firstActive || containerActive)) {\n      event.preventDefault()\n      this._focusableLastChild.focus()\n    } else if (noShift && lastActive) {\n      event.preventDefault()\n      this._focusableFirstChild.focus()\n    }\n  }\n\n  _handleFocusTrapWithArrows(event) {\n    const firstActive = document.activeElement === this._focusableFirstChild\n    const lastActive = document.activeElement === this._focusableLastChild\n    const arrowUp = event.which === KeyCodes.ARROW_UP\n    const arrowDown = event.which === KeyCodes.ARROW_DOWN\n\n    if (arrowUp || arrowDown) {\n      event.preventDefault()\n\n      if (firstActive && arrowUp) {\n        this._focusableLastChild.focus()\n      } else if (lastActive && arrowDown) {\n        this._focusableFirstChild.focus()\n      } else if (arrowDown) {\n        this._focusNextChild()\n      } else if (arrowUp) {\n        this._focusLastChild()\n      }\n    }\n  }\n\n  _focusNextChild() {\n    for (let i = 0; i < this._focusableChildren.length; i++) {\n      if (this._focusableChildren[i] === document.activeElement) {\n        this._focusableChildren[i + 1].focus()\n        break\n      }\n    }\n  }\n\n  _focusLastChild() {\n    for (let i = 0; i < this._focusableChildren.length; i++) {\n      if (this._focusableChildren[i] === document.activeElement) {\n        this._focusableChildren[i - 1].focus()\n        break\n      }\n    }\n  }\n}\n"],"file":"utils.js"}